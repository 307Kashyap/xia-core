#!/bin/bash

sudo apt-get update -qq
sudo apt-get install -qq -y git libxml2 libxml2-dev libssl-dev python-pip python-tk python-dev python-requests python-crypto build-essential openssl swig

sudo pip install pynacl

rel=$(lsb_release -d)

if [[ "$rel" =~ "14" ]]; then
    # travis doesn't have 16.04 images, so we need to be able to install
    # dependencies on 14.04 so everything will build

    # network x doesn't have a package in 14.04
    sudo pip install networkx

    # we need a more modern protobuf library
    wget http://launchpad.net/ubuntu/+archive/primary/+files/protobuf_2.6.1.orig.tar.gz
    tar xvzf protobuf_2.6.1.orig.tar.gz
    cd protobuf-2.6.1/
    ./configure
    make
    sudo make install
    sudo pip install protobuf==2.6.1
    sudo ldconfig
    cd ..

    # we also need mongodb and the mongodb-c library
    sudo apt-get install -y mongodb pkg-config libsasl2-dev

    wget https://github.com/mongodb/mongo-c-driver/releases/download/1.4.2/mongo-c-driver-1.4.2.tar.gz
    tar xzf mongo-c-driver-1.4.2.tar.gz
    cd mongo-c-driver-1.4.2
    ./configure
    make
    sudo make install
    cd ..

else
    sudo apt-get install -y python-networkx
    sudo apt-get install -y libprotobuf-dev protobuf-compiler python-protobuf
    sudo apt-get install -y mongodb libmongoc-dev libbson-dev
fi


