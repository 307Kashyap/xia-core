#!/usr/local/bin/gnuplot -c

csv = ARG1
video = ARG2
client = ARG3
cached = ARG4
dir = sprintf('"`dirname %s`"', csv)

bitrate_title = sprintf("client:%s video:%s cached:%s - cache vs bitrate", client, video, cached)
bitrate_file = sprintf("%s/bitrate-%s-%s-%s.pdf", @dir, client, video, cached)

speed_title = sprintf("client:%s video:%s cached:%s - transfer rate", client, video, cached)
speed_file = sprintf("%s/speed-%s-%s-%s.pdf", @dir, client, video, cached)

time_title = sprintf("client:%s video:%s cached%:s - transfer time", client, video, cached)
time_file = sprintf("%s/time-%s-%s-%s.pdf", @dir, client, video, cached)

size_title = sprintf("client:%s video:%s cached%:s - segment size", client, video, cached)
size_file = sprintf("%s/size-%s-%s-%s.pdf", @dir, client, video, cached)

cdn_title = sprintf("client:%s video:%s cached:%s - cdn", client, video, cached)
cdn_file = sprintf("%s/cdn-%s-%s-%s.pdf", @dir, client, video, cached)

# graph video bitrate and cached status
reset
set title bitrate_title
set term pdf color

set output bitrate_file
set multiplot

set grid
unset key
set style data dots
set lmargin screen 0.25

#set xdata time
#set timefmt "%S"
set xlabel "time (seconds)"
set xtics 50

#set ytics nomirror
#set y2tics

set ytics 1000000
set yrange [0:*]
set ylabel "video bitrate"
plot csv using 1:5

set ytics .5
set ytics offset  -10, 0
set yrange [-3:2]
set ylabel "cached"
plot csv using 1:7 linecolor 2

unset multiplot

# graph cdn and cached status
reset
set title cdn_title
set term pdf color

set output cdn_file
set multiplot

set grid
unset key
set style data dots
set lmargin screen 0.25

#set xdata time
#set timefmt "%S"
set xlabel "time (seconds)"
set xtics 50

#set ytics nomirror
#set y2tics

set ytics 1000000
set yrange [0:6]
set ylabel "cdn"
plot csv using 1:12

set ytics .5
set ytics offset  -10, 0
set yrange [-.5:6]
set ylabel "cached"
plot csv using 1:7 linecolor 2

unset multiplot


# graph xfer speed
reset
set output speed_file
set title speed_title
set term pdf color
set grid
unset key
set style data dots

set xlabel "time (seconds)"
set xtics 50

#set ytics 1000000
set yrange [0:*]
set ylabel "xfer rate (mbps)"
plot csv using 1:10



# graph segment size
reset
set output size_file
set title size_title
set term pdf color
set grid
unset key
set style data dots

set xlabel "time (seconds)"
set xtics 50

#set ytics 1000000
set yrange [0:*]
set ylabel "segment size (bytes)"
plot csv using 1:8



# graph xfer time
reset
set output time_file
set title time_title
set term pdf color
set grid
unset key
set style data dots

set xlabel "time (seconds)"
set xtics 50

#set ytics 1000000
set yrange [0:*]
set ylabel "xfer time (seconds)"
plot csv using 1:9

