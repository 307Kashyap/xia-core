#!/bin/sh

# wait for all nodes in the demo network to be up and running before launching the XIA code

cd /xia-core

READY=0
while [  $READY -eq 0 ]; do
	sleep 10

	READY=1
	for host in host0 router0 router1 server0 server1
	do
		ping -c1 $host
		if [ $? -ne 0 ]; then
			READY=0
		fi
	done
done

sleep 10
sudo bin/xianet -s `hostname -s`.click restart
sleep 5
sudo bin/xianet -s `hostname -s`.click restart

# make sure name server has loaded first so the registrations from the other nodes don't get lost
if [ `hostname -s` != "Host0" ]; then
	sleep 5
	sudo bin/xianet -s `hostname -s`.click restart
fi
