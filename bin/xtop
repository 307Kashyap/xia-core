#!/bin/bash
#
# run top with xia related processes only
#

[ "$1" == "-v" ] || [ "$1" == "--version" ] && echo "xtop 1.0" && exit 0

if [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
	cat << EOH
xtop [name] [name] ...

run top showing only the XIA related processes

options:
  name          additional processes to monitor
  -h, --help    display this help
  -v, --version display the version number
EOH
	exit 0
fi

# because they are python scripts, these daemons needs to be treated differently
x=$(pgrep -f 'xnetj|broker|pinger' | tr '\n' ',')

# get the rest of the click processes (replace \n in pgrep output with ,)
x="$x$(pgrep 'click|xrouted|xcontrold|xhostd|xcache|xname|xiaproxy|video_publisher|manifest_server|statsserver|xstats' | tr '\n ' ',')"

# add anything from the command line
for p in $@; do
	# pgrep may return multiple processes, so add commas if needed
	x="$x$(pgrep $p | tr '\n ' ',')"
done

#strip the trailing ,
x=${x%?}

[ "$x" ] && top -c -p "$x"
