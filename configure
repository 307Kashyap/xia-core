#!/bin/sh

OUTPUT=xia.mk

echo "# Autogenerated on $(date)" > $OUTPUT
echo "# DO NOT HAND EDIT!" >> $OUTPUT
echo >> $OUTPUT
echo XIADIR=$(pwd) >> $OUTPUT

cat >> $OUTPUT << EOF
APIDIR=\$(XIADIR)/api
BINDIR=\$(XIADIR)/bin
ETC=\$(XIADIR)/etc
XLIB=\$(APIDIR)/lib
XINC=\$(APIDIR)/include

CC=g++
LD=g++
CFLAGS=-Wall -Wextra -I\$(XINC)
LDFLAGS=-lpthread
ifeq (\$(wildcard \$(XLIB)/libXsocket.a),)
	LIBS=\$(XLIB)/libXsocket.so
else
	LIBS=\$(XLIB)/libXsocket.a -Bstatic -lprotobuf
endif

ifdef DEBUG
CFLAGS +=-ggdb -DDEBUG
else
CFLAGS +=-O2
endif

EOF
